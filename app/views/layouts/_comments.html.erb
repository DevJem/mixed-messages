
<%# render 'layouts/errors', obj: obj %>

 
<div class="row">
	<div class="col-md-8 col-md-offset-2">
		<div align="center">
			<% if !logged_in? %>
				<h3 class="fix-link"><strong><%= link_to "LOG IN TO ADD YOUR COMMENT!", login_path %></strong></h3>
			<% else %>
				<h3>Add Your Comment</h3>
		</div>
			<%= form_for(:comment, :html => {class: "form-horizontal", role: "form"}) do |f| %>
				<div class="form-group">
					<div class="control-label col-md-2">
						<% f.label :title %>
					</div>
					<div class="col-md-8">
						<%= f.text_field :title, class: "form-control", placeholder: "Title", autocomplete: false %>
					</div>
				</div>
				<div class="form-group">
					<div class="control-label col-md-2">
						<% f.label :comment %>
					</div>
					<div class="col-md-8">
						<%= f.text_area :comment, rows: 4, class: "form-control", placeholder: "Your Comment", autocomplete: false %>
					</div>
				</div>
				<div class="form-group">
					<div class="col-md-2 col-md-offset-2">
						<%= f.submit "Submit", class: "btn btn-primary btn-lg" %>
					</div>
				</div>
			<% end %>
		<% end %>
	</div>
</div>

<div class="container">
	<div class="row each-comment good-background">
		<div class="col-sm-9"> 
			<% if !obj.is_a? String %>

				<!-- Regular comments for blogs and user submissions -->
				<% obj.comments.order("id DESC").each do |comment| %>
					<div id=<%= "#{comment.id}" %> class="row">
						<div class="col-sm-12">
							<div class="comment-hr"/></div>
						</div>
						<div class="col-md-3" align="center">
							<strong><%= comment.user.username %></strong> <br/>
							<%= comment.created_at.localtime.strftime("%B %d, %Y") %> <br/>
							<%= comment.created_at.localtime.strftime("%l:%M %P")  %> <br/>
							Comment: <%= comment.id %> <br/>
						</div>
						<div class="col-md-8">
							<div align="left">
								<h4><strong><%= comment.title.upcase %></strong></h4><br/>
								<%= comment.comment %>
							</div>
						</div>
						<div class="col-md-1">

							<!-- flag button -->
							<% if logged_in? %>
								<% if !@flags.nil? and !@flags.empty? %>
									<% flag = @flags.where(comment_id: comment.id).where(user_id: current_user.id) %>
										<% if logged_in? && !flag.empty? %>
											<%= form_for(:report, url: report_path(flag.first.id), method: :delete, :html => {class: "form-horizontal", role: "form"}) do |f| %>
												<%= f.hidden_field :user_id, value: current_user.id %>
												<% if !comment.blog_id.nil? %>
													<%= f.hidden_field :blog_id, value: obj.id %>
												<% elsif !comment.upload_id.nil? %>
													<%= f.hidden_field :upload_id, value: obj.id %>
												<% end %>
												<%= f.hidden_field :comment_id, value: comment.id %>
												<%= f.submit "Unflag", class: "btn btn-sm btn-primary" %>
											<% end %>
										<% else %>
									
											<%= form_for(:report, url: reports_path, :html => {class: "form-horizontal", role: "form"}) do |f| %>
												<%= f.hidden_field :user_id, value: current_user.id %>
												<% if !comment.blog_id.nil? %>
													<%= f.hidden_field :blog_id, value: obj.id %>
												<% elsif !comment.upload_id.nil? %>
													<%= f.hidden_field :upload_id, value: obj.id %>
												<% end %>
												<%= f.hidden_field :comment_id, value: comment.id %>
												<%= f.submit "Flag  ", class: "btn btn-sm btn-primary" %>
											<% end %>
										<% end %>
								<% else %>
									<%= form_for(:report, url: reports_path, :html => {class: "form-horizontal", role: "form"}) do |f| %>
										<%= f.hidden_field :user_id, value: current_user.id %>
										<% if !comment.blog_id.nil? %>
											<%= f.hidden_field :blog_id, value: obj.id %>
										<% elsif !comment.upload_id.nil? %>
											<%= f.hidden_field :upload_id, value: obj.id %>
										<% end %>
										<%= f.hidden_field :comment_id, value: comment.id %>
										<%= f.submit "Flag  ", class: "btn btn-sm btn-primary" %>
									<% end %>
								<% end %>
							

								<!-- Delete button -->
								<% if current_user.admin? %>
									<%= link_to "Delete", comment_path(comment), method: :delete, class: "btn btn-sm btn-info" %>
								<% end %>
							<% end %>
						</div>
					</div> 
				<% end %>
			<% else %>

			<!-- Special comments for linked youtube videos -->
				<% comments = Comment.where(video_id: obj) %>
				<% comments.order("id DESC").each do |comment| %>
					<div id=<%= "#{comment.id}" %> class="row">
						<div class="col-sm-12">
							<div class="comment-hr"/></div>
						</div>
						<div class="col-md-3" align="center">
							<strong><%= comment.user.username %></strong> <br/>
							<%= comment.created_at.localtime.strftime("%B %d, %Y") %> <br/>
							<%= comment.created_at.localtime.strftime("%l:%M %P")  %> <br/>
							Comment: <%= comment.id %> <br/>
						</div>
						<div class="col-md-8">
							<div align="left">
								<h4><strong><%= comment.title.upcase %></strong></h4><br/>
								<%= comment.comment %>
							</div>
						</div>
						<div class="col-md-1">
							<% if logged_in? %>

								<!-- Flag button -->
								<% if !@flags.nil? and !@flags.empty? %>
									<% flag = @flags.where(comment_id: comment.id).where(user_id: current_user.id) %>
										<% if logged_in? && !flag.empty? %>
											<%= form_for(:report, url: report_path(flag.first.id), method: :delete, :html => {class: "form-horizontal", role: "form"}) do |f| %>
												<%= f.hidden_field :user_id, value: current_user.id %>
												<%= f.hidden_field :video_id, value: obj %>
												<%= f.hidden_field :comment_id, value: comment.id %>
												<%= f.submit "Unflag", class: "btn btn-sm btn-primary" %>
											<% end %>
										<% else %>
									
											<%= form_for(:report, url: reports_path, :html => {class: "form-horizontal", role: "form"}) do |f| %>
												<%= f.hidden_field :user_id, value: current_user.id %>
												<%= f.hidden_field :video_id, value: obj %>
												<%= f.hidden_field :comment_id, value: comment.id %>
												<%= f.submit "Flag", class: "btn btn-sm btn-primary" %>
											<% end %>
										<% end %>
								<% else %>
									<%= form_for(:report, url: reports_path, :html => {class: "form-horizontal", role: "form"}) do |f| %>
										<%= f.hidden_field :user_id, value: current_user.id %>
										<%= f.hidden_field :video_id, value: obj %>
										<%= f.hidden_field :comment_id, value: comment.id %>
										<%= f.submit "Flag", class: "btn btn-sm btn-primary" %>
									<% end %>
								<% end %>

								<!-- Delete button -->
								<% if current_user.admin? %>
									<%= link_to "Delete", comment_path(comment), method: :delete, class: "btn btn-sm btn-info" %>
								<% end %>
							<% end %>
						</div>
					</div> 
				<% end %>
			<% end %>
			<div class="col-sm-12">
				<div class="comment-hr"/></div>
			</div>
		</div>
		<div class="col-sm-3">
			<%= render 'layouts/ads' %>
		</div>
	</div>
</div>
